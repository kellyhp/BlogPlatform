{{! Use the main layout }}
{{!< main }}

{{! New Post Submission Form }}
<section>
    <div class="header-blog">
        <div class="blog-submit">
          <h1>Your Voice</h1>
          <p>
            Welcome to Your Voice, where you can write and post your own blog entries. 
            Whether you want to tell your story, provide insights, or spark a conversation, 
            this is your platform to be heard.
          </p>
          <a href="/profile">
            <button>Submit your story</button>
          </a>
        </div>
    </div>

    <div class="grid-posts">
        <div class="recent_container">
          <img src="/images/recent.png" alt="recent icon" class="recent"/>
          <h2> Most Recent </h2>
        </div>
        <div class="sort-dropdown">
            <label for="sort">Sort by:</label>
            <select id="sort" onchange="sortPosts()">
                <option value="recency">Recency</option>
                <option value="likes">Likes</option>
            </select>
        </div>
        <div class="grid-layout">
            {{#if posts.length}}
                {{#each posts}}
                    <div class="posts-blog">
                        {{> post this user=../user}}
                    </div>
                {{/each}}
            {{else}}
                <p>No posts for now</p>
            {{/if}}
        </div>
      </div>
</section>

{{! JavaScript for Emoji Integration and Sorting }}
<script>
function sortPosts() {
    const sortValue = document.getElementById('sort').value;
    fetch(`/?sort=${sortValue}`)
        .then(response => response.text())
        .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const newPostsList = doc.querySelector('.grid-layout').innerHTML;
            document.querySelector('.grid-layout').innerHTML = newPostsList;
        })
        .catch(error => console.error('Error fetching sorted posts:', error));
}
</script>
